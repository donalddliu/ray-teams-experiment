{"version":3,"sources":["meteor://ðŸ’»app/server/bots.js","meteor://ðŸ’»app/server/callbacks.js","meteor://ðŸ’»app/server/constants.js","meteor://ðŸ’»app/server/util.js","meteor://ðŸ’»app/server/main.js"],"names":["Empirica","module","link","default","v","bot","onStageTick","game","round","stage","secondsRemaining","getFullyConnectedLayer","moment","TimeSync","onGameStart","console","log","players","forEach","player","set","Date","now","network","get","activeChats","map","otherNodeId","pairOfPlayers","parseInt","sort","p1","p2","otherPlayer","find","p","chatKey","push","length","treatment","maxGameTime","add","onRoundStart","activePlayers","filter","endGameIfPlayerIdle","exit","minPlayerCount","onStageStart","name","displayName","onStageEnd","onRoundEnd","onGameEnd","onSet","target","targetType","key","value","prevValue","allSubmitted","numPlayersSubmitted","computeScore","submit","success","playerAnswers","allAnswersEqual","arr","every","submission","prevScore","export","testTangrams","allSymbols","_id","taskName","symbols","answer","getNeighbors","structure","neighbors","split","playerIndex","n","connection","replace","Set","activeNodes","allNodes","newNeighbors","id","testSymbols","gameInit","playerCount","networkStructure","numTaskRounds","numSurveyRounds","setSizeBasedOnPlayerCount","userInactivityDuration","taskDuration","defaultSetSize","surveyDuration","resultsDuration","maxNumOverlap","symbolSet","setSize","numRoundsBeforeSurvey","colors","surveyNum","shuffle","i","_","times","addRound","taskStage","addStage","durationInSeconds","getSymbolsForPlayers","resultStage","surveyRound","surveyStages","symbolsWithoutAnswer","symbol","numPlayers","numOverlap","symbolFreq","hasOwnProperty","symbolsPicked","symbolToRemove","j","Math","floor","random"],"mappings":"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","file":"/app.js","sourcesContent":["import Empirica from \"meteor/empirica:core\";\n\n// This is where you add bots, like Bob:\n\nEmpirica.bot(\"bob\", {\n  // // NOT SUPPORTED Called at the beginning of each stage (after onRoundStart/onStageStart)\n  // onStageStart(bot, game, round, stage, players) {},\n\n  // Called during each stage at tick interval (~1s at the moment)\n  onStageTick(bot, game, round, stage, secondsRemaining) {}\n\n  // // NOT SUPPORTED A player has changed a value\n  // // This might happen a lot!\n  // onStagePlayerChange(bot, game, round, stage, players, player) {}\n\n  // // NOT SUPPORTED Called at the end of the stage (after it finished, before onStageEnd/onRoundEnd is called)\n  // onStageEnd(bot, game, round, stage, players) {}\n});\n","import Empirica from \"meteor/empirica:core\";\n\nimport { getFullyConnectedLayer } from \"./util\";\nimport moment from \"moment\";\nimport { TimeSync } from \"meteor/mizzao:timesync\";\n\n\n\n// onGameStart is triggered opnce per game before the game starts, and before\n// the first onRoundStart. It receives the game and list of all the players in\n// the game.\nEmpirica.onGameStart(game => {\n  console.log(\"Game started\");\n  game.players.forEach((player) => {\n    player.set(\"inactive\", false);\n    player.set(\"lastActive\", moment(Date.now()));\n    const network = player.get(\"neighbors\");\n    const activeChats = [];\n    network.map(otherNodeId => {\n      var pairOfPlayers = [player.get(\"nodeId\"), parseInt(otherNodeId)];\n      pairOfPlayers.sort((p1,p2) => p1 - p2);\n      const otherPlayer = game.players.find(p => p.get(\"nodeId\") === parseInt(otherNodeId));\n      // const otherPlayerId = otherPlayer.id;\n      const chatKey = `${pairOfPlayers[0]}-${pairOfPlayers[1]}`;\n      activeChats.push(chatKey);\n    });\n    // Default all chats to be open when game starts\n    player.set(\"activeChats\", activeChats);\n  });\n  game.set(\"previousNumActivePlayers\", game.players.length);\n  game.set(\"gameStartTime\", moment(Date.now()));\n  if (game.treatment.maxGameTime) {\n    game.set(\"maxGameEndTime\", moment(Date.now()).add(game.treatment.maxGameTime, 'm'))\n  }\n});\n\n// onRoundStart is triggered before each round starts, and before onStageStart.\n// It receives the same options as onGameStart, and the round that is starting.\nEmpirica.onRoundStart((game, round) => {\n  game.players.forEach((player) => {\n    player.set(\"submitted\", false);\n    player.set(\"symbolSelected\", \"\");\n  });\n  round.set(\"result\", false);\n  round.set(\"numPlayersSubmitted\", 0);\n  // const activePlayers = game.players.filter(p => p.online === true && !p.get(\"inactive\"));\n  const activePlayers = game.players.filter(p => !p.get(\"inactive\"));\n\n  if (activePlayers.length < game.get(\"previousNumActivePlayers\") ) { // Someone left in the middle of the round\n    if (game.treatment.endGameIfPlayerIdle) {\n      activePlayers.forEach((p) => {\n        p.exit(\"someoneInactive\");\n      })\n    } else {\n      getFullyConnectedLayer(game); // Updates the neighbors to be fully connected\n      game.set(\"checkForSimilarSymbol\", true);\n    }\n  \n  }\n  game.set(\"previousNumActivePlayers\", activePlayers.length);\n\n  if (game.treatment.minPlayerCount && activePlayers.length < game.treatment.minPlayerCount) {\n    activePlayers.forEach((p) => {\n      p.exit(\"minPlayerCountNotMaintained\");\n    })\n  }\n\n  console.log(\"Round Started\");\n\n});\n\n// onStageStart is triggered before each stage starts.\n// It receives the same options as onRoundStart, and the stage that is starting.\nEmpirica.onStageStart((game, round, stage) => {\n  console.log(\"Stage Started\")\n  // const activePlayers = game.players.filter(p => p.online === true && !p.get(\"inactive\"));\n  const activePlayers = game.players.filter(p => !p.get(\"inactive\"));\n\n  if (stage.name === \"Task\") {\n    activePlayers.forEach((player) => {\n      console.log( `Symbols : ${player.get(`${stage.displayName}`)}`);\n    });\n    console.log(`Answer: ${stage.get(\"answer\")}`);\n  }\n  if (stage.name === \"Survey\") {\n    activePlayers.forEach((player) => {\n      player.set(\"surveyNumber\" , 1)\n    });\n  }\n  // game.players.forEach((player) => {\n  //   player.set(\"submitted\", false);\n  // });\n  // stage.set(\"showResults\", false);\n  // stage.set(\"resultsShown\", false);\n\n});\n\n// onStageEnd is triggered after each stage.\n// It receives the same options as onRoundEnd, and the stage that just ended.\nEmpirica.onStageEnd((game, round, stage) =>{\n  console.log(\"Stage Ended\")\n  \n});\n\n// onRoundEnd is triggered after each round.\n// It receives the same options as onGameEnd, and the round that just ended.\nEmpirica.onRoundEnd((game, round) => {\n  console.log(\"Round Ended\")\n  // game.players.forEach(player => {\n  //   const value = player.round.get(\"value\") || 0;\n  //   const prevScore = player.get(\"score\") || 0;\n  //   player.set(\"score\", prevScore + value);\n  // });\n\n});\n\n// onGameEnd is triggered when the game ends.\n// It receives the same options as onGameStart.\nEmpirica.onGameEnd(game => {});\n\n// ===========================================================================\n// => onSet, onAppend and onChange ==========================================\n// ===========================================================================\n\n// onSet, onAppend and onChange are called on every single update made by all\n// players in each game, so they can rapidly become quite expensive and have\n// the potential to slow down the app. Use wisely.\n//\n// It is very useful to be able to react to each update a user makes. Try\n// nontheless to limit the amount of computations and database saves (.set)\n// done in these callbacks. You can also try to limit the amount of calls to\n// set() and append() you make (avoid calling them on a continuous drag of a\n// slider for example) and inside these callbacks use the `key` argument at the\n// very beginning of the callback to filter out which keys your need to run\n// logic against.\n//\n// If you are not using these callbacks, comment them out so the system does\n// not call them for nothing.\n\n// // onSet is called when the experiment code call the .set() method\n// // on games, rounds, stages, players, playerRounds or playerStages.\n// Empirica.onSet((\n//   game,\n//   round,\n//   stage,\n//   player, // Player who made the change\n//   target, // Object on which the change was made (eg. player.set() => player)\n//   targetType, // Type of object on which the change was made (eg. player.set() => \"player\")\n//   key, // Key of changed value (e.g. player.set(\"score\", 1) => \"score\")\n//   value, // New value\n//   prevValue // Previous value\n// ) => {\n//   // // Example filtering\n//   // if (key !== \"value\") {\n//   //   return;\n//   // }\n// });\n\nEmpirica.onSet((\n  game,\n  round,\n  stage,\n  player, // Player who made the change\n  target, // Object on which the change was made (eg. player.set() => player)\n  targetType, // Type of object on which the change was made (eg. player.set() => \"player\")\n  key, // Key of changed value (e.g. player.set(\"score\", 1) => \"score\")\n  value, // New value\n  prevValue // Previous value\n) => {\n  const players = game.players;\n  // const activePlayers = game.players.filter(p => p.online === true && !p.get(\"inactive\"));\n  const activePlayers = game.players.filter(p => !p.get(\"inactive\"));\n\n  // Some player decides to reconsider their answer\n  console.log(\"key\", key);\n  if (key === \"submitted\") { \n    // Checks if everyone has submitted their answer and if so, submit the stage\n    let allSubmitted = true;\n    let numPlayersSubmitted = 0;\n    activePlayers.forEach((player) => {\n      if (player.get(\"submitted\")) {\n        numPlayersSubmitted += 1;\n      }\n      allSubmitted = player.get(\"submitted\") && allSubmitted;\n    })\n    round.set(\"numPlayersSubmitted\", numPlayersSubmitted);\n    if (allSubmitted) {\n      if (stage.name === \"Task\") {\n        computeScore(activePlayers, game, stage, round);\n      }\n      // Need to submit for submit the stage for every player\n      game.players.forEach((player) => {\n        player.stage.submit();\n      })\n    }\n  //   if (stage.get(\"resultsShown\")) {\n  //     players.forEach((player) => {\n  //       player.stage.submit();\n  //     })\n  //   }\n  // }\n\n  // if (targetType === \"stage\" && key === \"resultsShown\") {\n  //   if (stage.get(\"resultsShown\")) {\n  //     players.forEach((player) => {\n  //       player.stage.submit();\n  //     })\n  //   }\n  }\n\n  // else if (key === \"inactive\") {\n    // getFullyConnectedLayer(game);\n  // }\n\n  return;\n\n});\n\nfunction computeScore(activePlayers, game, stage, round) {\n  let success = true;\n  console.log(\"CORRECT ANSWER:\")\n  console.log(stage.get(\"answer\"));\n  console.log(\"Players guessed:\")\n\n  let playerAnswers = [];\n  const allAnswersEqual = arr => arr.every( v => v === arr[0] ) //Func to check if all player answers are equal\n\n  activePlayers.forEach(player => {\n    const submission = player.get(\"symbolSelected\");\n    console.log(submission);\n    if (game.get(\"checkForSimilarSymbol\")) {\n      playerAnswers.push(submission);\n    }\n    if (submission !== stage.get(\"answer\")) {\n      success = false;\n    }\n  })\n\n  if (game.get(\"checkForSimilarSymbol\")) {\n    if (allAnswersEqual(playerAnswers)) {\n      success = true;\n    }\n  }\n\n  round.set(\"result\", success);\n  if (success) {\n    activePlayers.forEach(player => {\n      const prevScore = player.get(\"score\") || 0;\n      player.set(\"score\", prevScore + 1);\n    })\n    console.log(\" All players got it correctly\");\n  } \n}\n\n// // onAppend is called when the experiment code call the `.append()` method\n// // on games, rounds, stages, players, playerRounds or playerStages.\n// Empirica.onAppend((\n//   game,\n//   round,\n//   stage,\n//   player, // Player who made the change\n//   target, // Object on which the change was made (eg. player.set() => player)\n//   targetType, // Type of object on which the change was made (eg. player.set() => \"player\")\n//   key, // Key of changed value (e.g. player.set(\"score\", 1) => \"score\")\n//   value, // New value\n//   prevValue // Previous value\n// ) => {\n//   // Note: `value` is the single last value (e.g 0.2), while `prevValue` will\n//   //       be an array of the previsous valued (e.g. [0.3, 0.4, 0.65]).\n// });\n\n\n// // onChange is called when the experiment code call the `.set()` or the\n// // `.append()` method on games, rounds, stages, players, playerRounds or\n// // playerStages.\n// Empirica.onChange((\n//   game,\n//   round,\n//   stage,\n//   player, // Player who made the change\n//   target, // Object on which the change was made (eg. player.set() => player)\n//   targetType, // Type of object on which the change was made (eg. player.set() => \"player\")\n//   key, // Key of changed value (e.g. player.set(\"score\", 1) => \"score\")\n//   value, // New value\n//   prevValue, // Previous value\n//   isAppend // True if the change was an append, false if it was a set\n// ) => {\n//   // `onChange` is useful to run server-side logic for any user interaction.\n//   // Note the extra isAppend boolean that will allow to differenciate sets and\n//   // appends.\n//    Game.set(\"lastChangeAt\", new Date().toString())\n// });\n\n// // onSubmit is called when the player submits a stage.\n// Empirica.onSubmit((\n//   game,\n//   round,\n//   stage,\n//   player // Player who submitted\n// ) => {\n// });\n","const allSymbols = [\"t1\", \"t2\", \"t3\", \"t4\", \"t5\", \"t6\", \"t7\",\"t8\",\"t9\",\"t10\",\"t11\",\"t12\"];\n\n// n = number of people , p = number of symbols\n// (n-1)*p + 1\n// i.e. n = 3, p = 3 : 7\n\nexport const testTangrams = [\n  {\n    _id: \"0\",\n    taskName: \"Task 1\",\n    symbols: allSymbols,\n    answer: \"t1\",\n  },\n  {\n    _id: \"1\",\n    taskName: \"Task 2\",\n    symbols: allSymbols,\n    answer: \"t2\",\n  },\n  {\n    _id: \"2\",\n    taskName: \"Task 3\",\n    symbols: allSymbols,\n    answer: \"t3\",\n  },\n  {\n    _id: \"3\",\n    taskName: \"Task 4\",\n    symbols: allSymbols,\n    answer: \"t4\",\n  },\n  {\n    _id: \"4\",\n    taskName: \"Task 5\",\n    symbols: allSymbols,\n    answer: \"t5\",\n  },\n  {\n    _id: \"5\",\n    taskName: \"Task 6\",\n    symbols: allSymbols,\n    answer: \"t6\",\n  },\n  {\n    _id: \"6\",\n    taskName: \"Task 7\",\n    symbols: allSymbols,\n    answer: \"t7\",\n  },\n  {\n    _id: \"7\",\n    taskName: \"Task 8\",\n    symbols: allSymbols,\n    answer: \"t8\",\n  },\n  {\n    _id: \"8\",\n    taskName: \"Task 9\",\n    symbols: allSymbols,\n    answer: \"t9\",\n  },\n  {\n    _id: \"9\",\n    taskName: \"Task 10\",\n    symbols: allSymbols,\n    answer: \"t10\",\n  },\n  {\n    _id: \"10\",\n    taskName: \"Task 11\",\n    symbols: allSymbols,\n    answer: \"t11\",\n  },\n  {\n    _id: \"11\",\n    taskName: \"Task 12\",\n    symbols: allSymbols,\n    answer: \"t12\",\n  },\n  {\n    _id: \"12\",\n    taskName: \"Task 13\",\n    symbols: allSymbols,\n    answer: \"t1\",\n  },\n  {\n    _id: \"13\",\n    taskName: \"Task 14\",\n    symbols: allSymbols,\n    answer: \"t2\",\n  },\n  {\n    _id: \"14\",\n    taskName: \"Task 15\",\n    symbols: allSymbols,\n    answer: \"t3\",\n  },\n\n];\n\n\n","export function getNeighbors(structure, player) {\n    const neighbors = [];\n    let network = structure.split(\",\");\n    const playerIndex = player.get(\"nodeId\");\n\n    network.forEach((n) => {\n      const connection = n.split(\"-\");\n\n      if (playerIndex === parseInt(connection[0])) {\n        neighbors.push(connection[1].replace(/\\s/g, ''));\n      } else if (playerIndex === parseInt(connection[1])) {\n        neighbors.push(connection[0].replace(/\\s/g, ''));\n      }\n    });\n  \n    return [... new Set(neighbors)];\n  }\n\nexport function getFullyConnectedLayer(game) {\n    const activeNodes = [];\n    const allNodes = [];\n    // const activePlayers = game.players.filter(p => p.online === true && !p.get(\"inactive\"));\n    const activePlayers = game.players.filter(p => !p.get(\"inactive\"));\n\n\n    // activePlayers.forEach((p) => {\n    //   activeNodes.push(`${p.get(\"nodeId\")}`);\n    // })\n\n    game.players.forEach((p) => {\n      // if (p.online === true && !p.get(\"inactve\")) {\n      if (!p.get(\"inactve\")) {\n\n        activeNodes.push(`${p.get(\"nodeId\")}`);\n      }\n      allNodes.push(`${p.get(\"nodeId\")}`);\n    })\n\n    game.players.forEach((p) => {\n      // Only show active people\n      // const newNeighbors = activeNodes.filter(id => parseInt(id) !== p.get(\"nodeId\"))\n      // p.set(\"neighbors\", newNeighbors);\n\n      // Show everyone, mark offline people as offline\n      const newNeighbors = allNodes.filter(id => parseInt(id) !== p.get(\"nodeId\"))\n      p.set(\"neighbors\", newNeighbors);\n    })\n}","import Empirica from \"meteor/empirica:core\";\nimport \"./bots.js\";\nimport \"./callbacks.js\";\n\nimport { testSymbols, testTangrams } from \"./constants\"; \nimport { getNeighbors, getFullyConnectedLayer } from \"./util\";\n\n// gameInit is where the structure of a game is defined.\n// Just before every game starts, once all the players needed are ready, this\n// function is called with the treatment and the list of players.\n// You must then add rounds and stages to the game, depending on the treatment\n// and the players. You can also get/set initial values on your game, players,\n// rounds and stages (with get/set methods), that will be able to use later in\n// the game.\nEmpirica.gameInit(game => {\n  const {\n    treatment: {\n      playerCount,\n      networkStructure,\n      numTaskRounds,\n      numSurveyRounds,\n      setSizeBasedOnPlayerCount,\n      userInactivityDuration,\n      taskDuration,\n      defaultSetSize,\n      surveyDuration,\n      resultsDuration,\n      maxNumOverlap,\n    },\n  } = game;\n\n\n  const symbolSet = testTangrams;\n  const setSize = setSizeBasedOnPlayerCount ? playerCount + 1 : defaultSetSize; //TODO: can change default value in settings\n  const numRoundsBeforeSurvey = numTaskRounds/numSurveyRounds;\n\n  let colors = [\"Green\", \"Red\", \"Yellow\", \"Blue\", \"Purple\", \"White\", \"Black\"]\n  let surveyNum = 1\n  colors = shuffle(colors);\n\n  game.players.forEach((player, i) => {\n    player.set(\"avatar\", `/avatars/jdenticon/${player._id}`);\n    player.set(\"score\", 0);\n\n    // Give each player a nodeId based on their position (indexed at 1)\n    player.set(\"nodeId\", i + 1);\n    player.set(\"name\", player.id);\n    player.set(\"anonymousName\", colors[i])\n  });\n\n\n  if (game.players.length < game.treatment.playerCount) { // if not a full game, default to fully connected layer\n    getFullyConnectedLayer(game);\n    game.players.forEach((p) => {\n      console.log(p.get(\"neighbors\"));\n    });\n  } else {\n    game.players.forEach((p) => {\n      p.set(\"neighbors\", getNeighbors(networkStructure, p));\n      console.log(p.get(\"neighbors\"));\n    });\n  }\n\n  // For each round, add all the symbols, randomly select a correct answer and\n  // Constraints: Must ensure that everyone has only one symbol in common\n  _.times( numTaskRounds, i => {\n    const round = game.addRound();\n\n    const {symbols, taskName, answer} = symbolSet[i];\n\n    const taskStage = round.addStage({\n      name: \"Task\",\n      displayName: taskName,\n      answer: answer,\n      durationInSeconds: taskDuration\n    });\n    taskStage.set(\"task\", symbolSet[i]);\n    getSymbolsForPlayers(symbols, answer, setSize, taskName, game, maxNumOverlap)\n    taskStage.set(\"answer\", symbolSet[i].answer)\n\n    const resultStage = round.addStage({\n      name: \"Result\",\n      displayName: \"Result\",\n      durationInSeconds: resultsDuration\n    });\n    \n    if ((i+1) % numRoundsBeforeSurvey === 0) { // After 5 task rounds, add a survey round\n      const surveyRound = game.addRound();\n\n      const surveyStages = surveyRound.addStage({\n        name: \"Survey\",\n        displayName: \"Survey \" + surveyNum,\n        durationInSeconds: surveyDuration\n      })\n      \n      surveyNum++;\n    }\n\n  });\n\n\n\n  function getSymbolsForPlayers(symbolSet, answer, setSize, taskName, game, maxNumOverlap) {\n      let symbolsWithoutAnswer = symbolSet.filter(symbol => symbol !== answer);\n      symbolsWithoutAnswer = shuffle(symbolsWithoutAnswer);\n      let numPlayers = game.players.length;\n      let numOverlap = 0;\n\n\n      // Create a dictionary to keep track of how many times symbol has been used\n      let symbolFreq = {}\n      for (let i = 0; i < symbolsWithoutAnswer.length; i++) {\n        let symbol = symbolsWithoutAnswer[i]\n        if (!symbolFreq.hasOwnProperty(symbol)) {\n          symbolFreq[symbol] = numPlayers - 1; // Total time a symbol can be used \n        }\n      }\n\n      game.players.forEach((player) => {\n        let symbolsPicked = [];\n        for (let i = 0; i < symbolsWithoutAnswer.length; i++) {\n          let symbol = symbolsWithoutAnswer[i]\n          if (symbolsPicked.length < setSize - 1) { // Add symbols until setSize - 1 for answer\n            if (symbolFreq[symbol] - 1 === 0) { // This symbol will overlap\n                if (numOverlap < maxNumOverlap ) { // Only add if less than max overlap\n                  symbolsPicked.push(symbol);\n                  symbolFreq[symbol] -= 1;\n                  numOverlap += 1\n                }\n            } else {\n              symbolsPicked.push(symbol);\n              symbolFreq[symbol] -= 1;\n            }\n          }\n        }\n        symbolsPicked.push(answer); // Add the answer\n        for (var symbolToRemove of symbolsPicked) {\n          if (symbolFreq[symbolToRemove] === 0) { // If symbol has been picked n-1 players times, remove it from the set\n            symbolsWithoutAnswer = symbolsWithoutAnswer.filter(symbol => symbol !== symbolToRemove);\n\n          }\n        }\n\n        symbolsPicked = shuffle(symbolsPicked);\n\n        player.set(taskName, symbolsPicked);\n      })\n\n\n  }\n\n  // Shuffling arrays:\n  // https://stackoverflow.com/questions/50536044/swapping-all-elements-of-an-array-except-for-first-and-last\n  function shuffle(symbolSet) {\n    for (i = symbolSet.length -1 ; i > 0; i--) {\n      const j = Math.floor(Math.random() * (i + 1));\n\n      [symbolSet[i], symbolSet[j]] = [symbolSet[j], symbolSet[i]];\n    }\n    return symbolSet;\n  }\n\n});\n"]}